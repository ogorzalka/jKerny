/*!
 * jKerny.js
 * Version: 1.3
 * Copyright 2011 Olivier Gorzalka
 * CSS Parser adapted the jQuery based CSS parser from Daniel Wachsstock Copyright (c) 2011
 * MIT license
 */
(function($){var y="undefined",v="span.jkerny-word",a="span.jkerny-letter",l=":eq(",c=" ",h="";function parsedeclarations(n){var i=munged[n].replace(/^{|}$/g,h),t;return i=munge(i),t={},$.each(i.split(";"),function(n,i){i=i.split(":");if(i.length<2)return;t[restore(i[0])]=restore(i.slice(1).join(":"))}),t}function munge(n,t){n=n.replace(REatcomment,"$1").replace(REcomment_string,function(n,t){if(!t)return h;var i="%s`"+ ++uid+"`s%";return munged[uid]=t.replace(/^\\/,h),i});var i=t?REfull:REbraces;while(match=i.exec(n))replacement="%b`"+ ++uid+"`b%",munged[uid]=match[0],n=n.replace(i,replacement);return n}function restore(n){if(n===undefined)return n;while(match=REmunged.exec(n))n=n.replace(REmunged,munged[match[1]]);return $.trim(n)}function processAtRule(n,t){var i=n.split(/\s+/),u=i.shift(),f,r;u=="media"?(f=restore(i.pop()).slice(1,-1),$.parsecss.mediumApplies(i.join(c))&&$.parsecss(f,t)):(u="import")&&(r=restore(i.shift()),$.parsecss.mediumApplies(i.join(c))&&(r=r.replace(/^url\(|\)$/gi,h).replace(/^["']|["']$/g,h),$.get(r,function(n){$.parsecss(n,t)})))}function styleAttributes(n,t){var r=h,u,i={};n=n.replace(RESGMLcomment,h).replace(REnotATag,"$1"),munge(n).replace(REtag,function(n,t,f){t=t.toLowerCase(),i[t]?++i[t]:i[t]=1;if(u=/\bstyle\s*=\s*(%s`\d+`s%)/i.exec(f)){var e=/\bid\s*=\s*(\S+)/i.exec(f);e=e?"#"+restore(e[1]).replace(/^['"]|['"]$/g,h):t+l+(i[t]-1)+")",r+=[e,"{",restore(u[1]).replace(/^['"]|['"]$/g,h),"}"].join(h)}}),$.parsecss(r,t)}function injector(n,t,i,r){var f=n.text().split(t),u=h;f.length&&($(f).each(function(n,t){u+='<span class="'+i+(n+1)+'">'+t+"</span>"+r}),n.empty().append(u))}var media,munged,methods;$.parsecss=function(n,t){var i={};n=munge(n).replace(/@(([^;`]|`[^b]|`b[^%])*(`b%)?);?/g,function(n,i){return processAtRule($.trim(i),t),h}),$.each(n.split("`b%"),function(n,t){t=t.split("%b`");if(t.length<2)return;t[0]=restore(t[0]),i[t[0]]=$.extend(i[t[0]]||{},parsedeclarations(t[1]))}),t(i)},$.parsecss.mediumApplies=window.media&&window.media.query||function(n){if(!n)return!0;if(n in media)return media[n];var t=$('<style media="'+n+'">body {position: relative; z-index: 1;}</style>').appendTo("head");return media[n]=([$("body").css("z-index")==1,t.remove()])[0]},$.parsecss.isValidSelector=function(n){var t=$("<style>"+n+"{}</style>").appendTo("head")[0];return([t.styleSheet?!/UNKNOWN/i.test(t.styleSheet.cssText):!!t.sheet.cssRules.length,$(t).remove()])[0]},$.parsecss.parseArguments=function(str){var ret,mungedArguments,i,a;if(!str)return[];for(ret=[],mungedArguments=munge(str,!0).split(/\s+/),i=0;i<mungedArguments.length;++i){a=restore(mungedArguments[i]);try{ret.push(eval("("+a+")"))}catch(err){ret.push(a)}}return ret},$.parsecss.styleAttributes=styleAttributes,media={},munged={};var REbraces=/{[^{}]*}/,REfull=/\[[^\[\]]*\]|{[^{}]*}|\([^()]*\)|function(\s+\w+)?(\s*%b`\d+`b%){2}/,REatcomment=/\/\*@((?:[^\*]|\*[^\/])*)\*\//g,REcomment_string=/(?:\/\*(?:[^\*]|\*[^\/])*\*\/)|(\\.|"(?:[^\\\"]|\\.|\\\n)*"|'(?:[^\\\']|\\.|\\\n)*')/g,REmunged=/%\w`(\d+)`\w%/,uid=0;var RESGMLcomment=/<!--([^-]|-[^-])*-->/g,REnotATag=/(>)[^<]*/g,REtag=/<(\w+)([^>]*)>/g;methods={init:function(){return this.each(function(){injector($(this),h,"char",h)})},words:function(){return this.each(function(){injector($(this),c,"word",c)})},lines:function(){return this.each(function(){var n="eefec303079ad17405c889e092e105b0";injector($(this).children("br").replaceWith(n).end(),n,"line",h)})}},$.fn.lettering=function(n){return n&&methods[n]?methods[n].apply(this,[].slice.call(arguments,1)):n==="letters"||!n?methods.init.apply(this,[].slice.call(arguments,0)):($.error("Method "+n+" does not exist on jQuery.lettering"),this)},$.jkerny={lettering_replace:{":word *:first-letter":"span.jkerny-word span.jkerny-letter:first-child",":word *:last-letter":"span.jkerny-word span.jkerny-letter:last-child",":letter":a,":word":v,":first-word":"span.jkerny-word:first-child",":last-word":"span.jkerny-word:last-child",":first-letter":"span.jkerny-word:first-child span.jkerny-letter:first-child",":last-letter":"span.jkerny-word:last-child span.jkerny-letter:last-child"},only_selectors:[/span\.jkerny-(word|letter)/],only_properties:[/-jkerny-(word|letter)-spacing/],pseudo_selectors:/:(hover|active|focus|visited)/,run:function(){var t={},n=this;$("style:not([rel=jkerny]),link[rel=stylesheet]").each(function(){this.href?$.ajax({url:this.href,success:function(t){n.parseCss(t)}}):n.parseCss(this.innerHTML)})},parseCss:function(n){var t=this,n=t.convertPseudoSelectors(n);$.parsecss(n,function(n){selectors=t.filterSelectors(n),t.proceedCss(selectors)})},convertPseudoSelectors:function(n){var i=this,t;for(t in i.lettering_replace)n=n.replace(new RegExp(t,"g"),c+i.lettering_replace[t]);return n},rawCss:function(n,t){var i=n+" { ";for(attribute in t)i+=attribute+":"+t[attribute]+"; ";return i+="} "},applyCss:function(n,t){if(n.indexOf(":hover")>-1){var i=n.split(":hover"),r=$(i[0]);r.on("mouseenter",function(){$styledElements=$.trim(i[1])!=h?$(this).find($.trim(i[1])):$(this),$styledElements.data({"default-style":$styledElements.attr("style")}).css(t)});r.on("mouseleave",function(){$styledElements=$.trim(i[1])!=h?$(this).find($.trim(i[1])):$(this),$styledElements.attr("style",$styledElements.data("default-style"))})}else $(n).css(t)},proceedCss:function(n){var f="-jkerny-word-spacing",u=" span.jkerny-word",e="-jkerny-letter-spacing",r=this,o="span.jkerny-word, span.jkerny-letter { display:inline-block } .jkerny { visibility: inherit; }",s,i,t;for(selector in n){s=$(selector.replace(this.pseudo_selectors,h).split(/ span.jkerny-(letter|word)/g)[0]),s.not(".jkerny").addClass("jkerny").lettering("words").children("span").addClass("jkerny-word").lettering().children("span").addClass("jkerny-letter");if(typeof n[selector][e]!=y)for(i=n[selector][e].replace(/[\n\s]+/g,c).split(c),t=0;t<=i.length;t++)r.applyCss(selector+(selector.indexOf(v)>-1?h:u)+(selector.indexOf(a)>-1?h:" span")+l+t+")",{marginRight:i[t]});if(typeof n[selector][f]!=y)for(i=n[selector][f].replace(/[\n\s]+/g,c).split(c),t=0;t<=i.length;t++)r.applyCss(selector+(selector.indexOf(v)>-1?h:u)+l+t+")",{marginRight:i[t]});$.each(r.only_selectors,function(){selector.match(this)&&(o+=r.rawCss(selector,n[selector]))})}$('<style rel="jkerny">'+o+"</style>").appendTo("body")},filterSelectors:function(n){var r=this,i,t;if(typeof n==y)return[];i=n;if(r.only_selectors&&r.only_selectors.length||r.only_properties&&r.only_properties.length){var u=r.only_selectors,f=r.only_properties,e={},o=[];for(t=0;t<u.length;t++)for(selector in i)(typeof u[t]=="string"?selector==u[t]:selector.match(u[t]))&&(e[selector]=i[selector],o.push(i[selector].selector));for(t=0;t<f.length;t++)for(selector in i)for(attribute in i[selector])if(typeof f[t]=="string"?attribute.selector==f[t]:attribute.match(f[t])&&jQuery.inArray(selector,o)<0){e[selector]=i[selector];continue}i=e}return i}},$(function(){$.jkerny.run()})})(jQuery)