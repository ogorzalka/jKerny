/*global jQuery */
/*!
 * jKerny.js
 * Version: 1.33
 * Copyright 2011 Olivier Gorzalka
 * CSS Parser adapted from the jQuery based CSS parser by Daniel Wachsstock Copyright (c) 2011
 * MIT license
 */
// jkerny opts
var jk_opts = {
    crossbrowser : true // it makes pseudo-selectors work with old browsers. Great but bad for performance
};
this.CSS||(this.CSS=function(b){var h,b=b.document,k=b.documentElement,k=k.getElementsByTagName("head")[0]||k,m=b.implementation||{hasFeature:function(){return!1}},b=b.createElement("style");b.type="text/css";k.insertBefore(b,k.firstChild);h=b.sheet||b.styleSheet;return{supportSelector:m.hasFeature("CSS2","")?function(b){if(!h||!b)return!1;try{h.insertRule(b+"{ }",0),h.deleteRule(h.cssRules.length-1)}catch(k){return!1}return!0}:function(b){if(!h||!b)return!1;h.cssText=b+" { }";return 0!==h.cssText.length&& !/unknown/i.test(h.cssText)&&0===h.cssText.indexOf(b)}}}(this)); (function(b){function h(a){var a=n[a].replace(/^{|}$/g,""),c={},a=k(a);b.each(a.split(";"),function(a,b){b=b.split(":");2>b.length||(c[m(b[0])]=m(b.slice(1).join(":")))});return c}function k(a,b){for(var a=a.replace(x,"$1").replace(y,function(a,b){if(!b)return"";var c="%s`"+ ++o+"`s%";n[o]=b.replace(/^\\/,"");return c}),d=b?z:A;match=d.exec(a);)replacement="%b`"+ ++o+"`b%",n[o]=match[0],a=a.replace(d,replacement);return a}function m(a){if(void 0===a)return a;for(;match=u.exec(a);)a=a.replace(u,n[match[1]]); return b.trim(a)}function w(a,c){var d=a.split(/\s+/),e=d.shift();"media"==e?(e=m(d.pop()).slice(1,-1),b.parsecss.mediumApplies(d.join(" "))&&b.parsecss(e,c)):"import"==e&&(e=m(d.shift()),b.parsecss.mediumApplies(d.join(" "))&&(e=e.replace(/^url\(|\)$/gi,"").replace(/^["']|["']$/g,""),b.get(e,function(a){b.parsecss(a,c)})))}function q(a,c,d,e){var c=a.text().split(c),f="";c.length&&(b(c).each(function(a,b){f+='<span class="'+d+(a+1)+'">'+b+"</span>"+e}),a.empty().append(f))}b.parsecss=function(a, c){var d={},a=k(a).replace(/@(([^;`]|`[^b]|`b[^%])*(`b%)?);?/g,function(a,f){w(b.trim(f),c);return""});b.each(a.split("`b%"),function(a,c){c=c.split("%b`");2>c.length||(c[0]=m(c[0]),d[c[0]]=b.extend(d[c[0]]||{},h(c[1])))});c(d)};b.parsecss.mediumApplies=window.media&&window.media.query||function(a){if(!a)return!0;if(a in r)return r[a];b('<style media="'+a+'">body {position: relative; z-index: 1;}</style>').appendTo("head");return r[a]=1==b("body").css("z-index")};var r={},n={},A=/{[^{}]*}/,z=/\[[^\[\]]*\]|{[^{}]*}|\([^()]*\)|function(\s+\w+)?(\s*%b`\d+`b%){2}/, x=/\/\*@((?:[^\*]|\*[^\/])*)\*\//g,y=/(?:\/\*(?:[^\*]|\*[^\/])*\*\/)|(\\.|"(?:[^\\\"]|\\.|\\\n)*"|'(?:[^\\\']|\\.|\\\n)*')/g,u=/%\w`(\d+)`\w%/,o=0,s={init:function(){return this.each(function(){q(b(this),"","char","")})},words:function(){return this.each(function(){q(b(this)," ","word"," ")})},lines:function(){return this.each(function(){q(b(this).children("br").replaceWith("eefec303079ad17405c889e092e105b0").end(),"eefec303079ad17405c889e092e105b0","line","")})}};b.fn.lettering=function(a){if(a&& s[a])return s[a].apply(this,[].slice.call(arguments,1));if("letters"===a||!a)return s.init.apply(this,[].slice.call(arguments,0));b.error("Method "+a+" does not exist on jQuery.lettering");return this};b.jkerny_style=function(a,c){options=b.extend({type:"text/css",media:"all",styleClass:"default"},c);var d=document,e=d.createElement("style"),f="",j;for(j in a)if(a[j].hasOwnProperty){var f=f+(j+" {"),i;for(i in a[j])f+=i+":"+a[j][i]+"; ";f+="} "}d.createStyleSheet?d.getElementsByTagName("head")[0].insertAdjacentHTML("beforeEnd", '&nbsp;<style class="'+options.styleClass+'" media="'+options.media+'" type="text/css">'+f+"</style>"):(e=d.createElement("style"),e.type="text/css",e.media=options.media,e.className=options.styleClass,e.appendChild(d.createTextNode(f)),d.getElementsByTagName("head")[0].appendChild(e))};var v={":unknown":"",":((first|last)(-))?(letter|word)":"._$2$3$4","._(letter|word):(first|last)-child":"._$2-$1","._((last|first)-)letter":"span.jkerny-word:$2-child span.jkerny-letter:$2-child","._((last|first)-)word":"span.jkerny-word:$2-child", "._(letter|word)":"span.jkerny-$1","(span.jkerny-word([^ ]*)?) *span.jkerny-word:(first|last)-child":"$1"},t=/(>|~|\+)? span.jkerny-(letter|word)/gi,g="all",p=0,l={};b.jkerny={run:function(){var a=this;b.jkerny_style({"span.jkerny-word, span.jkerny-letter":{display:"inline-block"},".jkerny":{visibility:"inherit"}},{styleClass:"jkerny"});b("style:not(.jkerny),link[rel=stylesheet]").each(function(){l[g]={};this.href&&!this.disabled&&!(0>this.href.indexOf("//"+window.location.host)&&/^\w+:/.test(this.href))? b.ajax({url:this.href,success:function(c){g="undefined"==typeof b(this).attr("media")?"all":b(this).attr("media");a.parseCss(c)}}):(g="undefined"==typeof b(this).attr("media")?"all":b(this).attr("media"),a.parseCss(b(this).removeAttr("type").html()))})},parseMediaQueries:function(a){if(a=a.match(RegExp(/@media([^\{]+)\{([^\{\}]+\{[^\}\{]+\})+/),"gi"))for(var c=0;c<a.length;c++)g=b.trim(a[1]),"undefined"==typeof l[g]&&(l[g]={}),this.parseCss(a[2],!0)},parseCss:function(a,c){var d=this,e=c||!1,a=d.convertPseudoSelectors(a); b.parsecss(a,function(a){selectors=d.filterSelectors(a);d.proceedCss(selectors)});!1===e&&d.parseMediaQueries(a)},convertPseudoSelectors:function(a){for(var b in v)a=a.replace(RegExp(b,"gi")," "+v[b]);return a},getLength:function(a){var b=0,d;for(d in a)b++;return b},applyProperties:function(a,c){var d,e,f,j,i;j=c.split(",");for(i=0;i<j.length;i++)j[i].replace(RegExp(":(hover|enabled|disabled|focus|checked|target|active|visited|after|before)","gi"),"").split(t),d=b(j[i].replace(RegExp(":(hover|enabled|disabled|focus|checked|target|active|visited|after|before)", "gi"),"")),f=d.is(".jkerny-letter")?"letter":"word",e=j[i].replace(RegExp("span.jkerny-(letter|word)(:(eq|empty|(first|last|only|nth(-last)?)-(child|of-type))([^\\)]*\\))?)?","gi"),".jkerny-$1-"+p),d.addClass("jkerny-"+f+"-"+p).parent(".jkerny-word").addClass("jkerny-word-"+p),l[g][e]=a[c];p++},proceedCss:function(a){var c,d,e;if(0<this.getLength(a))for(var f in a){c=f.split(",");for(e=0;e<c.length;e++)d=b(c[e].replace(RegExp(":(hover|enabled|disabled|focus|checked|target|active|visited|after|before)", "gi"),"").split(t)[0]),d.not(".jkerny").addClass("jkerny").lettering("words").children("span").addClass("jkerny-word").lettering().children("span").addClass("jkerny-letter");console.log(f,CSS.supportSelector(f));jk_opts.crossbrowser&&!CSS.supportSelector(f)?this.applyProperties(a,f):l[g][f]=a[f]}0<this.getLength(l[g])&&(b.jkerny_style(l[g],{media:g,styleClass:"jkerny"}),l[g]={})},filterSelectors:function(a){var b={},d=[],e,f,j,i,h,g;for(g in a){-1<g.indexOf("jkerny-")&&(b[g]=a[g]);for(var k in a[g])if(e= k.match(RegExp(/-jkerny-(letter|word)-spacing/),"gi")){d=a[g][e[0]].replace(/[\n\s]+/g," ").split(" ");f=g.split(",");for(i=0;i<f.length;i++)for(h=0;h<d.length;h++)j=f[i].replace(RegExp(":(hover|enabled|disabled|focus|checked|target|active|visited|after|before)","gi"),"").split(t)[0],b[j+" span.jkerny-"+e[1]+":eq("+h+")"]={"margin-right":d[h]}}}return b}};b(function(){b.jkerny.run()})})(jQuery);